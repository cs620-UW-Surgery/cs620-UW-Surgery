datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model KnowledgeChunk {
  id              String   @id @default(uuid())
  sourceDoc       String
  sourcePageStart Int?
  sourcePageEnd   Int?
  text            String
  hash            String   @unique
  version         Int      @default(1)
  citationKey     String   @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  embedding       KnowledgeEmbedding?
}

model KnowledgeEmbedding {
  id        String   @id @default(uuid())
  chunkId   String   @unique
  model     String
  vector    Float[]
  createdAt DateTime @default(now())

  chunk KnowledgeChunk @relation(fields: [chunkId], references: [id], onDelete: Cascade)
}

model Session {
  id             String         @id
  createdAt      DateTime       @default(now())
  messages       Message[]
  checklistItems ChecklistItem[]
}

model Message {
  id          String   @id @default(uuid())
  sessionId   String
  role        String
  contentJson Json?
  contentText String?
  createdAt   DateTime @default(now())

  session Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model ChecklistItem {
  id        String   @id @default(uuid())
  sessionId String
  label     String
  status    String
  createdAt DateTime @default(now())

  session Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, label])
}

model AppConfig {
  key       String   @id
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
